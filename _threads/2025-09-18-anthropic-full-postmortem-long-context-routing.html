---
layout: thread
title: "Anthropic full postmortem "
date: 2025-09-18 11:26:19 +0000
bluesky_url: https://bsky.app/profile/did:plc:ckaz32jwl6t2cno6fmuw2nhn/post/3lz4ajoph3s2s
likes: 33
reposts: 1
post_count: 9
summary: "Anthropic full postmortem   - long context routing bug - output corruption bug - approx top-k bug on TPU  plus: why it was so difficult and slow to fi..."
similar:
  - url: "/threads/2025-06-28-claudius-the-shopkeeper-anthropic-had-sonnet-37/"
    title: "Claudius the shopkeeper "
  - url: "/threads/2025-12-05-anthropic-is-going-after-enterprises-because-its-p/"
    title: "Anthropic is going after enterprises because its predictable"
  - url: "/threads/2025-06-07-there-are-reports-that-anthropic-does-this-serve/"
    title: "there are reports that anthropic does this — serves a reduced quant under hig..."
---
<div class="thread-post">
<div class="post-text">Anthropic full postmortem <br><br>- long context routing bug<br>- output corruption bug<br>- approx top-k bug on TPU<br><br>plus: why it was so difficult and slow to fix <br><br>this is going to be a thread<br><br><a href="https://www.anthropic.com/engineering/a-postmortem-of-three-recent-issues" target="_blank" rel="noopener">www.anthropic.com/engineering/...</a></div>
<a href="https://www.anthropic.com/engineering/a-postmortem-of-three-recent-issues" class="post-embed" target="_blank" rel="noopener">
<div class="embed-content">
<div class="embed-domain">www.anthropic.com</div>
<div class="embed-title">A postmortem of three recent issues</div>
<div class="embed-description">This is a technical report on three bugs that intermittently degraded responses from Claude. Below we explain what happened, why it took time to fix, and what we're changing.</div>
</div>
</a>
<div class="post-stats">
<span class="stat-item"><svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>33</span>
<span class="stat-item"><svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>1</span>
</div>
</div>
<div class="thread-post">
<div class="post-text">but you should<br><br>seriously, i appreciate the details, but even what’s here feels like the minimum level of transparency. imo we’re owed more than this</div>
<div class="post-images single">
<div class="post-image-container">
<img src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:ckaz32jwl6t2cno6fmuw2nhn/bafkreid4gvf3rwe5sgocimvhklotebr73vaynjhcg3kjswjqmtacawdoum@jpeg" alt="We don't typically share this level of technical detail about our infrastructure, but the scope and complexity of these issues justified a more comprehensive explanation." class="post-image" loading="lazy">
<div class="image-alt">We don't typically share this level of technical detail about our infrastructure, but the scope and complexity of these issues justified a more comprehensive explanation.</div>
</div>
</div>
<div class="post-stats">
<span class="stat-item"><svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>2</span>
</div>
</div>
<div class="thread-post">
<div class="post-text">1. Long Context Routing<br><br>to support 1M context, they apparently have different servers (presumably differently mid-trained model) for LC requests <br><br>a routing bug caused them to be mis-routed<br><br>routing is “sticky”, so affected sessions continue being effected<br><br>(so, not stateless?)</div>
<div class="post-stats">
<span class="stat-item"><svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>4</span>
</div>
</div>
<div class="thread-post">
<div class="post-text">2. Output Corruption <br><br>sampler bug: when selecting the next token, they chose low probability tokens <br><br>caused by a performance optimization, only impacted Opus 4-4.1 on TPU only<br><br>(okay, so sampling is done in a kernel, llama.cpp/ollama does it on CPU)</div>
<div class="post-stats">
<span class="stat-item"><svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>4</span>
</div>
</div>
<div class="thread-post">
<div class="post-text">3. Approx Top-K on TPU<br><br>another sampler bug, only on TPU<br><br>models are partitioned across many GPUs. logits are in bf16, but aggregated in fp32<br><br>different GPUs returning different precision meant they were exposed to a mixed-precision bug in JAX<br><br>damn, both floating point & dist sys in one bug..</div>
<div class="post-stats">
<span class="stat-item"><svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>5</span>
</div>
</div>
<div class="thread-post">
<div class="post-text">Why Detection Was Hard<br><br>- testing was too low cardinality<br>- privacy guarantees meant engineers couldn’t just crack open requests and see what was going wrong<br>- mixed hardware<br>- dist sys: each bug manifested differently and at different rates on different platforms</div>
<div class="post-stats">
<span class="stat-item"><svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>4</span>
</div>
</div>
<div class="thread-post">
<div class="post-text">Action Items<br><br>- more sensitive evals: can’t do more data, so needs to be more sensitive <br>- canaries: run some evals continuously in prod<br>- faster debugging tools</div>
<div class="post-stats">
<span class="stat-item"><svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>2</span>
</div>
</div>
<div class="thread-post">
<div class="post-text">Takeaways:<br><br>- long context is extremely hard: Anthropic completely gave up on serving all requests with the same model<br><br>- NVIDIA’s advantage is fewer sharp edges. JAX is great, but still weird<br><br>- time to detection and time to recovery should still be your top metrics</div>
<div class="post-stats">
<span class="stat-item"><svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>5</span>
</div>
</div>
<div class="thread-post">
<div class="time-elapsed">2 hours later</div>
<div class="post-text"></div>
<div class="post-images single">
<div class="post-image-container">
<img src="https://cdn.bsky.app/img/feed_thumbnail/plain/did:plc:ckaz32jwl6t2cno6fmuw2nhn/bafkreickbyiziqdlfer2lihey4nlbzhlzvz6qu5dw65vjnilq3s3zuzlay@jpeg" alt="near
@nearcyan • 13h
...
this confirms my claude is french hypothesis; one may think it is evidence to the contrary, but remember that anthropic employees use claude internally, and in fact all three of these bugs were pushed during August, the longest time-off period for the French, often 2-3 weeks off!
Claude &
AI
@claudeai • 16h
We've published a detailed postmortem on three infrastructure bugs that affected Claude between August and early
September...." class="post-image" loading="lazy">
<div class="image-alt">near
@nearcyan • 13h
...
this confirms my claude is french hypothesis; one may think it is evidence to the contrary, but remember that anthropic employees use claude internally, and in fact all three of these bugs were pushed during August, the longest time-off period for the French, often 2-3 weeks off!
Claude &
AI
@claudeai • 16h
We've published a detailed postmortem on three infrastructure bugs that affected Claude between August and early
September....</div>
</div>
</div>
<div class="post-stats">
<span class="stat-item"><svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>1</span>
</div>
</div>